Bootstrap: docker
From: mlrorg/mlr3-full:latest

%post
  set -e

  # Use pak from the base image if available; otherwise install it.
  R --slave -e "if (!requireNamespace('pak', quietly = TRUE)) install.packages('pak', repos='https://cloud.r-project.org')"

  # Add mlr3 r-universe + r-multiverse (same idea as mlr3docker)
  R --slave -e "Sys.setenv(NOT_CRAN='true'); \
                pak::repo_add(mlr3universe='https://mlr-org.r-universe.dev', \
                              multiverse='https://community.r-multiverse.org')"

  # Install ONLY the requested packages, with HARD dependencies only (no Suggests)
  R --slave -e "Sys.setenv(NOT_CRAN='true'); \
                pak::pak(c( \
                  'gausscov', \
                  'praznik', \
                  'FSelectorRcpp', \
                  'care', \
                  'caret', \
                  'Boruta', \
                  'MislavSag/mlr3finance' \
                ), dependencies='hard', ask=FALSE)"

  # If you need torch runtime binaries inside the container, uncomment:
  # R --slave -e "torch::install_torch()"

%environment
  export NOT_CRAN="true"

%runscript
  exec Rscript "$@"